import{W as M,X as P,R as I,r as b,j as e,b as q,V as E}from"./index-B5IrYwSf.js";import{u as V,D as B,C as G,a as W,A as $}from"./useDebounce-CtS5788L.js";import{T}from"./Tag-BgPA-gGY.js";import{b as w,c as Q,d as U,e as X,f as _,g as H,h as J,i as Y,A as k}from"./index-DzIjJXQ9.js";import{c as S,D as O}from"./Dialog-uXgwdOg_.js";import{B as p,I as F,u as Z,F as ee,a as A,C as L}from"./index.esm-CCO8k5GL.js";import{C as R}from"./index-CIt6kdqh.js";import{t as se,z as D}from"./index-CzVxQRl_.js";import{S as te}from"./StickyFooter-Du0ECql9.js";import{N as ae}from"./Notification-nsktbxlj.js";import{t as re}from"./toast-Bf3WYsML.js";import{R as oe}from"./RichTextEditor-CdKe52n2.js";import{C as ne}from"./ConfirmDialog-SACwPh4o.js";import"./Card-BwF7YU63.js";import"./useControllableState-DqCAkSU0.js";import"./CloseButton-Cfj2d_0a.js";import"./Pagination-N3uZXzPk.js";import"./Select-BaPAiwbL.js";import"./floating-ui.dom-4meoaf82.js";import"./index-DPUiuvHR.js";import"./debounce-B0zjTqoc.js";import"./toString-DGAcNTrc.js";import"./useMergeRef-CbC_Qfe6.js";import"./StatusIcon-BYLHsQ-F.js";import"./index-R_st83Tk.js";import"./useUniqueId-B4COUAd7.js";import"./uniqueId-CiKHi5Kj.js";async function le(s){return M.fetchDataWithAxios({url:"/customers",method:"get",params:s})}const ie={pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},ce={purchasedProducts:"",purchaseChannel:["Retail Stores","Online Retailers","Resellers","Mobile Apps","Direct Sales"]},de={tableData:ie,filterData:ce,selectedCustomer:[]},me=P(s=>({...de,setFilterData:t=>s(()=>({filterData:t})),setTableData:t=>s(()=>({tableData:t})),setSelectedCustomer:(t,l)=>s(r=>{const n=r.selectedCustomer;return t?{selectedCustomer:[...n,l]}:n.some(d=>l.id===d.id)?{selectedCustomer:n.filter(d=>d.id!==l.id)}:{selectedCustomer:n}}),setSelectAllCustomer:t=>s(()=>({selectedCustomer:t}))}));function y(){const{tableData:s,filterData:t,setTableData:l,selectedCustomer:r,setSelectedCustomer:n,setSelectAllCustomer:d,setFilterData:m}=me(C=>C),{data:i,error:c,isLoading:g,mutate:u}=V(["/api/customers",{...s,...t}],([C,j])=>le(j),{revalidateOnFocus:!1}),x=(i==null?void 0:i.list)||[],h=(i==null?void 0:i.total)||0;return{customerList:x,customerListTotal:h,error:c,isLoading:g,tableData:s,filterData:t,mutate:u,setTableData:l,selectedCustomer:r,setSelectedCustomer:n,setSelectAllCustomer:d,setFilterData:m}}const ue={active:"bg-emerald-200 dark:bg-emerald-200 text-gray-900 dark:text-gray-900",blocked:"bg-red-200 dark:bg-red-200 text-gray-900 dark:text-gray-900"},he=({row:s})=>e.jsx("div",{className:"flex items-center",children:e.jsx(q,{className:"hover:text-primary ml-2 rtl:mr-2 font-semibold text-gray-900 dark:text-gray-100",to:`/concepts/customers/customer-details/${s.id}`,children:s.name})}),xe=({onEdit:s,onViewDetail:t})=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(w,{title:"Edit",children:e.jsx("div",{className:"text-xl cursor-pointer select-none font-semibold",role:"button",onClick:s,children:e.jsx(Q,{})})}),e.jsx(w,{title:"View",children:e.jsx("div",{className:"text-xl cursor-pointer select-none font-semibold",role:"button",onClick:t,children:e.jsx(U,{})})})]}),pe=()=>{const s=I(),{customerList:t,customerListTotal:l,tableData:r,isLoading:n,setTableData:d,setSelectAllCustomer:m,setSelectedCustomer:i,selectedCustomer:c}=y(),g=a=>{s("/Outlet-Module-editOutlet")},u=a=>{s(`/concepts/customers/customer-details/${a.id}`)},x=b.useMemo(()=>[{header:"Name",accessorKey:"name",cell:a=>{const o=a.row.original;return e.jsx(he,{row:o})}},{header:"Outlet ID",accessorKey:"outletId"},{header:"Category",accessorKey:"category"},{header:"Route",accessorKey:"route"},{header:"Range",accessorKey:"range"},{header:"Address 1",accessorKey:"address1"},{header:"Address 2",accessorKey:"address2"},{header:"Address 3",accessorKey:"address3"},{header:"Owner Name",accessorKey:"ownerName"},{header:"Mobile Number",accessorKey:"mobileNumber"},{header:"Open Time",accessorKey:"openTime"},{header:"Close Time",accessorKey:"closeTime"},{header:"Latitude",accessorKey:"latitude"},{header:"Longitude",accessorKey:"longitude"},{header:"Outlet Sequence",accessorKey:"outletSequence"},{header:"Is Approved",accessorKey:"isApproved",cell:a=>{const o=a.row.original;return e.jsx("div",{className:"flex items-center",children:e.jsx(T,{className:o.isApproved?"bg-emerald-200 dark:bg-emerald-200 text-gray-900 dark:text-gray-900":"bg-red-200 dark:bg-red-200 text-gray-900 dark:text-gray-900",children:e.jsx("span",{className:"capitalize",children:o.isApproved?"Approved":"Not Approved"})})})}},{header:"Status",accessorKey:"status",cell:a=>{const o=a.row.original;return e.jsx("div",{className:"flex items-center",children:e.jsx(T,{className:ue[o.status],children:e.jsx("span",{className:"capitalize",children:o.status})})})}},{header:"",id:"action",cell:a=>e.jsx(xe,{onEdit:()=>g(a.row.original),onViewDetail:()=>u(a.row.original)})}],[]),h=a=>{d(a),c.length>0&&m([])},C=a=>{const o=S(r);o.pageIndex=a,h(o)},j=a=>{const o=S(r);o.pageSize=Number(a),o.pageIndex=1,h(o)},f=a=>{const o=S(r);o.sort=a,h(o)},v=(a,o)=>{i(a,o)},N=(a,o)=>{if(a){const K=o.map(z=>z.original);m(K)}else m([])};return e.jsx(B,{selectable:!0,columns:x,data:t,noData:!n&&t.length===0,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:n,pagingData:{total:l,pageIndex:r.pageIndex,pageSize:r.pageSize},checkboxChecked:a=>c.some(o=>o.id===a.id),onPaginationChange:C,onSelectChange:j,onSort:f,onCheckBoxChange:v,onIndeterminateCheckBoxChange:N})},ge=()=>{const s=I(),{customerList:t}=y();return e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx(G,{className:"w-full",filename:"customerList.csv",data:t,children:e.jsx(p,{icon:e.jsx(X,{className:"text-xl"}),className:"w-full",children:"Download"})}),e.jsx(p,{variant:"solid",icon:e.jsx(_,{className:"text-xl"}),onClick:()=>s("/Outlet-Module-editOutlet"),children:"Add new"})]})},fe=s=>{const{wait:t=500,ref:l,...r}=s;function n(i){var c;(c=s.onChange)==null||c.call(s,i)}const d=W(n,t),m=i=>{d(i)};return e.jsx(F,{ref:l,...r,onChange:m})},Ce=s=>{const{onInputChange:t,ref:l}=s;return e.jsx(fe,{ref:l,placeholder:"Quick search...",suffix:e.jsx(H,{className:"text-lg"}),onChange:r=>t(r.target.value)})},je=["Retail Stores","Online Retailers","Resellers","Mobile Apps","Direct Sales"],be=D.object({purchasedProducts:D.string(),purchaseChannel:D.array(D.string())}),ye=()=>{const[s,t]=b.useState(!1),{filterData:l,setFilterData:r}=y(),n=()=>{t(!0)},d=()=>{t(!1)},{handleSubmit:m,reset:i,control:c}=Z({defaultValues:l,resolver:se(be)}),g=u=>{r(u),t(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(p,{icon:e.jsx(J,{}),onClick:()=>n(),children:"Filter"}),e.jsxs(O,{isOpen:s,onClose:d,onRequestClose:d,children:[e.jsx("h4",{className:"mb-4",children:"Filter"}),e.jsxs(ee,{onSubmit:m(g),children:[e.jsx(A,{label:"Products",children:e.jsx(L,{name:"purchasedProducts",control:c,render:({field:u})=>e.jsx(F,{type:"text",autoComplete:"off",placeholder:"Search by purchased product",...u})})}),e.jsx(A,{label:"Purchase Channel",children:e.jsx(L,{name:"purchaseChannel",control:c,render:({field:u})=>e.jsx(R.Group,{vertical:!0,className:"flex mt-4",...u,children:je.map((x,h)=>e.jsx(R,{name:u.name,value:x,className:"justify-between flex-row-reverse heading-text",children:x},x+h))})})}),e.jsxs("div",{className:"flex justify-end items-center gap-2 mt-4",children:[e.jsx(p,{type:"button",onClick:()=>i(),children:"Reset"}),e.jsx(p,{type:"submit",variant:"solid",children:"Apply"})]})]})]})]})},De=()=>{const{tableData:s,setTableData:t}=y(),l=r=>{const n=S(s);n.query=r,n.pageIndex=1,typeof r=="string"&&r.length>1&&t(n),typeof r=="string"&&r.length===0&&t(n)};return e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsx(Ce,{onInputChange:l}),e.jsx(ye,{})]})},Se=()=>{const{selectedCustomer:s,customerList:t,mutate:l,customerListTotal:r,setSelectAllCustomer:n}=y(),[d,m]=b.useState(!1),[i,c]=b.useState(!1),[g,u]=b.useState(!1),x=()=>{m(!0)},h=()=>{m(!1)},C=()=>{const f=t.filter(v=>!s.some(N=>N.id===v.id));n([]),l({list:f,total:r-s.length},!1),m(!1)},j=()=>{u(!0),setTimeout(()=>{re.push(e.jsx(ae,{type:"success",children:"Message sent!"}),{placement:"top-center"}),u(!1),c(!1),n([])},500)};return e.jsxs(e.Fragment,{children:[s.length>0&&e.jsx(te,{className:" flex items-center justify-between py-4 bg-white dark:bg-gray-800",stickyClass:"-mx-4 sm:-mx-8 border-t border-gray-200 dark:border-gray-700 px-8",defaultClass:"container mx-auto px-8 rounded-xl border border-gray-200 dark:border-gray-600 mt-4",children:e.jsx("div",{className:"container mx-auto",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:s.length>0&&e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg text-primary",children:e.jsx(Y,{})}),e.jsxs("span",{className:"font-semibold flex items-center gap-1",children:[e.jsxs("span",{className:"heading-text",children:[s.length," ","Customers"]}),e.jsx("span",{children:"selected"})]})]})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",customColorClass:()=>"border-error ring-1 ring-error text-error hover:border-error hover:ring-error hover:text-error",onClick:x,children:"Delete"}),e.jsx(p,{size:"sm",variant:"solid",onClick:()=>c(!0),children:"Message"})]})]})})}),e.jsx(ne,{isOpen:d,type:"danger",title:"Remove customers",onClose:h,onRequestClose:h,onCancel:h,onConfirm:C,children:e.jsxs("p",{children:[" ","Are you sure you want to remove these customers? This action can't be undo."," "]})}),e.jsxs(O,{isOpen:i,onRequestClose:()=>c(!1),onClose:()=>c(!1),children:[e.jsx("h5",{className:"mb-2",children:"Send Message"}),e.jsx("p",{children:"Send message to the following customers"}),e.jsx(k.Group,{chained:!0,omittedAvatarTooltip:!0,className:"mt-4",maxCount:4,omittedAvatarProps:{size:30},children:s.map(f=>e.jsx(w,{title:f.name,children:e.jsx(k,{size:30,src:f.img,alt:""})},f.id))}),e.jsx("div",{className:"my-4",children:e.jsx(oe,{content:""})}),e.jsxs("div",{className:"ltr:justify-end flex items-center gap-2",children:[e.jsx(p,{size:"sm",onClick:()=>c(!1),children:"Cancel"}),e.jsx(p,{size:"sm",variant:"solid",loading:g,onClick:j,children:"Send"})]})]})]})},Je=()=>e.jsxs(e.Fragment,{children:[e.jsx(E,{children:e.jsx($,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsx("h3",{children:"Customers"}),e.jsx(ge,{})]}),e.jsx(De,{}),e.jsx(pe,{})]})})}),e.jsx(Se,{})]});export{Je as default};
